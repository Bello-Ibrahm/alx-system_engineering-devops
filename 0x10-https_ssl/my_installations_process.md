# Certbot installation [Here](https://eff-certbot.readthedocs.io/en/latest/install.html) and [Here](https://certbot.eff.org/instructions?ws=haproxy&os=ubuntufocal)

## Run Certbot with -v:
Rerun Certbot with the -v option to get more verbose output and additional details about the issue:
``` sudo certbot certonly --standalone -d belloibrahim.tech -v ```

- Review Certbot Log:
Check the Certbot log file for more detailed information:
``` sudo cat /var/log/letsencrypt/letsencrypt.log ```

- Certificate is saved at:
```/etc/letsencrypt/live/www.belloibrahim.tech/fullchain.pem```

Key is saved at:
```/etc/letsencrypt/live/www.belloibrahim.tech/privkey.pem```

## Step for the configurations
1. Combine the certificate and key generated by the certbot into haproxy directory.
```DOMAIN='www.belloibrahim.tech' sudo -E bash -c 'cat /etc/letsencrypt/live/$DOMAIN/fullchain.pem /etc/letsencrypt/live/$DOMAIN/privkey.pem > /etc/haproxy/certs/$DOMAIN.pem'```

2. Change the mode and access right for the dir `/etc/haproxy/certs`
```sudo chmod 400 /etc/haproxy/certs/www.belloibrahim.tech.pem```
```sudo chown haproxy:haproxy /etc/haproxy/certs/www.belloibrahim.tech.pem```
  - `chmod 400`: Restricts read permission to the owner only.
  - `chown haproxy`:haproxy: Changes the ownership of the file to the haproxy user and group.
Other option: ```sudo chmod -R go-rwx /etc/haproxy/certs/```

3. Followed this haproxy conf [resourse](https://www.haproxy.com/blog/the-four-essential-sections-of-an-haproxy-configuration) for the configurations
4. Check the validitation of the haproxy.cfg file: ```haproxy -c -f /etc/haproxy/haproxy.cfg```
5. If valid, restart the haproxy: ```sudo service haproxy restart```
